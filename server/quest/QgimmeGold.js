"use strict";
var s = require('./../Quest_exports').init('v1.0','QgimmeGold');
var q = s.quest; var m = s.map; var b = s.boss;

q.name = "[NAME]";

/* STEPS TO COMPLETE QUEST
	Goal: Cheer up the sad guy by giving him 3 gold.

	STEPS:
*****Enter house.
		-Answer Quiz and get 1 gold
*****Enter Dragon Lair.
*****Kill 10 enemies to unblock path.
		-Kill Dragon King and get 1 gold
		-Activate switch to unlock chest
		-Loot the chest to get 1 gold.
		-Talk with sad guy and give him 3 gold.
	
	
	
	
	
	
	
*/

q.variable = {
	killDragon:0,
	haveDoneQuiz:false,
	chestLocked:true,
	lootChest:false,
	killMinion:0,
};

q.event = {
	killMinion:function(key){
		s.set(key,'killMinion','+1');
	},
	viewBlock:function(key){
		return s.get(key,'killMinion') < 10;
	},	
	teleTownLair:function(key){
		s.teleport(key,'dragonLair','t1','solo');
	},
	teleLairTown:function(key){
		s.teleport(key,'tinyTown','t2');
	},
	teleTownHouse:function(key){
		s.teleport(key,'bobHouse','t1');
	},
	teleHouseTown:function(key){
		s.teleport(key,'tinyTown','t1');
	},
	viewChest:function(key){
		return s.get(key,'lootChest') === false;
	},
	lootChest:function(key){
		if(s.get(key,'chestLocked') === false){
			s.addItem(key,'gold',1);
			s.set(key,'lootChest',true);
		} else {
			s.chat(key,'This chest is locked.');
		}
	},
	viewTgOn:function(key){
		return s.get(key,'chestLocked') === true;
	},
	tgOnChest:function(key){
		s.set(key,'chestLocked',false);
	},
	talkRingo:function(key){
		s.dialogue(key,'ringo','cheerup','intro');
	},
	killDragon:function(key){
		if(s.get(key,'killDragon') === 0){
			s.addItem(key,'gold',1);
			s.set(key,'killDragon',1);
		}
	},
	giveGold:function(key){
		s.addItem(key,'gold',1);
		s.set(key,'haveDoneQuiz',true);
	},
	talkBob:function(key){
		if(s.get(key,'haveDoneQuiz') === false){
			s.dialogue(key,'bob','quiz','intro');
		} else {
			s.dialogue(key,'bob','quiz','alreadydone');
		}
	},
	testCheerUp:function(key){
		if(s.haveItem(key,'gold',3) === true){
			s.dialogue(key,'ringo','cheerup','yes');
			s.completeQuest(key);
		} else {
			s.dialogue(key,'ringo','cheerup','no');
		}
	}
};	

q.item['gold'] = s.item('Gold');

q.dialogue['ringo'] = {
	cheerup:{
		intro:{
			text:"Hello, I'm sad.",
			option:[
				{text:"I'll cheer you up.",
					event:q.event.testCheerUp
				},
				{text:"Bye."},
			]
		},
		yes:{
			text:"Thanks a lot."
		},
		no:{
			text:"You don't have 3 gold."
		},
	}
};

	
q.dialogue['bob'] = {
	quiz:{
		intro:{
			text:"Hello, let's do a quiz.",
			option:[
				{text:"Sure.",
					next:{node:'question1'},
				},
				{text:"Bye."},
			]
		},
		alreadydone:{
			text:"You have already done the quiz!",
		},
		wrong:{
			text:"Wrong!",
		},
		question1:{
			text:"What is the name of the NPC you want to cheer up:",
			option:[
				{text:"Zezima.",next:{node:'wrong'}},
				{text:"Ringo.",next:{node:'question2'}},
				{text:"Hulk.",next:{node:'wrong'}},
			]
		},
		question2:{
			text:"0,1,1,2,3,5,8,13,...:",
			option:[
				{text:"21.",next:{node:'success'}},
				{text:"18.",next:{node:'wrong'}},
				{text:"9001.",next:{node:'wrong'}},
			]
		},
		success:{
			text:"Congratz! Here's your gold!",
			event:q.event.giveGold,
		},
	}
};

q.map.bobHouse = function(){
	var map = m.map();
	map.name = "BobHouse";
	map.graphic = "bobHouse";
	map.lvl = 0;
	map.tileset = "v1.2";
	map.grid = ["00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000011111111111111001111111111111111000000","00000000000011111111111111001111111111111111000000","00000000000011111111111111001111111111111111000000","00011111111111111111111111111111111111111111111000","00011111111111111111111111111111111111111111111000","00011111111111111111111111111111111111111111111000","00011111111111111111111111111111111111111111111000","00011111111111011111100011111101111111111011111000","00011111111111011111100011111100000000000011111000","00011111111111000000000011111100000000000011111000","00011111111000000000000001111000000000000000011000","00011111111000000000000000000000000000000001111000","00011000000000000000000000000000000000000001111000","00011000000000000000000000000000000000000001111000","00011110000000000000000001111111111000000000011000","00011110000000000000000111111111111110000000011000","00011110000000000000000111111111111110000000011000","00011110000000000000000111111111111110000000011000","00011110000000000000000111111111111110000000011000","00011000000000000000000111111111111110000000011000","00011000000000000000000001111111111000000000011000","00011111100000000000000000000000000000000111111000","00011111100000000000000000000000000000000111111000","00011111111111000000000000000000000000000011111000","00011111111111000000000000000000000000000011111000","00011111111111000000000000000000000000000011111000","00011111111111111111111111111111111111111111111000","00011111111111111111111111111111111111111111111000","00011111111111111111111111111111111111111111111000","00011111111111111111111111111111111111111111111000","00000000000011111111111111111111111111111111000000","00000000000011111111111111111111111111111111000000","00000000000011111111111111111111111111111111000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000"]
	var a = map.addon[q.id] = {};
	a.spot = {"n1":{"x":528,"y":560},"t1":{"x":656,"y":848}};
	a.variable = {}; 
	a.load = function(spot){
		m.actor(spot.n1,"npc","regular",{dialogue:q.event.talkBob,name:"Bob"});
		m.teleport(spot.t1,q.event.teleHouseTown,'zone',{angle:90});
	
	} 
	a.loop = function(spot){} 
	return map;
};
q.map.tinyTown = function(){
	var map = m.map();
	map.name = "Tiny Town";
	map.graphic = "tinyTown";
	map.lvl = 0;
	map.tileset = "v1.2";
	map.grid = ["00000000000000000000000000000111100000001111000011","00011111111111111111111111111111000000000111111011","00111111111111111111111111111110000000000011111100","01111111111111111111111111111100000000000001111110","01111111111111111111111111111000000000000000111110","01100000000000000000000000000000000000000000000110","01100000000000000000000000000000000000000000000110","01100000111111111110000000000000000000000001100110","01100001000000000001000000000000000000000001100110","01100001000000000001000111100000000000000000000110","01100001000000000001000111100000000000000000000110","01100001000000000001000111100000000000000000000110","01100001000000000001000000000000000000000000000110","01100001000000000001000000000000000000000000000110","01100001000000000001000000000000000000000000000110","01100001100010001011000000000000000000000000000110","01100001111110001111000000000000000000000000000110","01100000111110001110000000000000000000001111000110","01100000000010001000000000000000000000001111000110","01100110000000000000000000000000000000001111000110","01100110000000000000000000000000000000000000000110","01100000000000000000000000000000011111111100000110","00111111100000000000000000000111111111111111000110","00011111110000000000000000011111111111111111110110","00000000011000000000000000011111111111111111110110","00000000001100000000000000011111111111111111110110","00011110000110000000000000011111111111111111110110","00011110011011000000000000011111111111111111110110","00011110011001100000000000011111111111111111110110","00000000000011100000000000011111111111111111110110","00000000000111100000000000011111111111111111110110","00000000111111000000000000011111111111111111110110","00000001111110000000000000011111111111111111110110","01100011111100000000000000011111111111111111110110","01100011111000000000000000011111111111111111110110","00000011000011110000000000000000011111111111110110","00000011000011110000000000001111011111111111110110","00000011000011110000000000001111011111111100110110","00000011000000000000000000001111011111111100110110","00000001111100000000000000000000000000000000000110","00000000111110000000000000000000000000000000000110","00000000000011000000000000000000000000000000000110","00111100000001100000000000000000000000001111000110","00111100000001101111111100000000000000001111000110","00111100000001101111111100000000000000001111000110","00111100011001101111100000000000000000000000000110","00000000011001100000000000000000000000000000000110","00000000000000111111111111111111111111111111111100","00000000000000011111111111111111111111111111111000","00000000000000000000000000000000000000000000000000"]
	var a = map.addon[q.id] = {};
	a.spot = {"t2":{"x":1168,"y":48},"q1":{"x":336,"y":336},"q2":{"x":496,"y":336},"n1":{"x":656,"y":1200},"t1":{"x":1200,"y":1232},"n2":{"x":1168,"y":1360}};
	a.variable = {}; 
	a.load = function(spot){
		m.actor(spot.n1,"npc","regular",{dialogue:q.event.talkRingo,name:"Ringo"});
		m.toggle(spot.q1,q.event.viewTgOn,q.event.tgOnChest,null);
		m.loot(spot.q2,q.event.viewChest,q.event.lootChest,'chest');
		m.teleport(spot.t1,q.event.teleTownHouse,'door');
		m.teleport(spot.t2,q.event.teleTownLair,'zone');
	
	} 
	a.loop = function(spot){} 
	return map;
};
q.map.dragonLair = function(){
	var map = m.map();
	map.name = "DragonLair";
	map.graphic = "dragonLair";
	map.lvl = 0;
	map.tileset = "v1.2";
	map.grid = ["22222222222222222222222222222222222222222222222222","22222222222222222222222222222222222222222222222222","22222222222222222222222222222222222222222222222222","22222222222222222222222222222222222222222222222222","22222222222222222222222222222222222222222222222222","22222222222222222222222222222222222222222222222222","22222222222220000000000000000000000000002222222222","22222222222000000000000000000000000000000022222222","22222222200000000111100000000000000000000022222222","22222220000000000111100000000000000000000022222222","22222220000000000111100000000000000000000022222222","22222220000000000000000000000011110000000022222222","22222220000000000000000000000011110000000022222222","22222220000000000000000000000011110000000022222222","22222220000000000000000000000000000000000022222222","22222220000000000000000000000000000000000022222222","22222220000000000000000000000000000000000022222222","22222220000000011110000000000000000000000022222222","22222220000000011110000000000000000000000022222222","22222220000000011110000000000000000000000222222222","22222220000000000000000000000000000000000222222222","22222220000000000000000000000000000000002222222222","22222220000000000000000000000000000000002222222222","22222222000000000000000000000011000000022222222222","22222222200000000000000000000011000000022222222222","22222222220000000000000000000000000000222222222222","22222222222220000000000000000000000000222222222222","22222222222222000000000000000000000002222222222222","22222222222222200000000000000000000002222222222222","22222222222222220000000000000000000022222222222222","22222222222222200000000000000000000022222222222222","22222222222222200000000000000000000222222222222222","22222222222222200000000000000000000222222222222222","22222222222222200000000000000000002222222222222222","22222222222222200000000000000000022222222222222222","22222222222222200000000000000222222222222222222222","22222222222222200000000000002222222222222222222222","22222222222222200000000000022222222222222222222222","22222222222222200000000000222222222222222222222222","22222222222222200000000000222222222222222222222222","22222222222222200000000000222222222222222222222222","22222222222222200000000000222222222222222222222222","22222222222222200000000000222222222222222222222222","22222222222222200000000000222222222222222222222222","22222222222222200000000000222222222222222222222222","22222222222222200000000000222222222222222222222222","22222222222222200000000000222222222222222222222222","22222222222222200000000000222222222222222222222222","22222222222222200000000000222222222222222222222222","22222222222222000000000000022222222222222222222222","22222222222220000000000000002222222222222222222222","22222222222220000000000000000000222222222222222222","22222222222220000000000000000000002222222222222222","22222222222220000000000000000000000022222222222222","22222222222220000000000000000000000000222222222222","22222222222220000000000000000000000000002222222222","22222222222220000000000000000000000000002222222222","22222222222200000000000000000000000000002222222222","22222222222200000000000000000000000000002222222222","22222222222000000000000000000011110000000222222222","22222222222000000000000000000011110000000222222222","22222222220000110000000000000011110000000022222222","22222222220000110000000000000000000000000022222222","22222222200000000000000000000000000000000002222222","22222222200000000000000000000000000000000002222222","22222222000000000000000000000000000000000000222222","22222220000000000000000000000000000000000000222222","22222000000000000000000000000000000000000000222222","22222000000000000000000000000000000011000000222222","22222000001111000000000000000000000011000000222222","22222000001111000000000000000000000000000000222222","22222000001111000000000000000000000000000000222222","22222000000000000000000000000000000000000000222222","22222000000000000000000000000000000000000000222222","22222000000000000000000000000000000000000000222222"]
	var a = map.addon[q.id] = {};
	a.spot = {"e1":{"x":784,"y":528},"b1":[480,800,1440,1440],"e2":{"x":624,"y":2032},"e3":{"x":848,"y":2128},"t1":{"x":720,"y":2352}};
	a.variable = {}; 
	a.load = function(spot){
	
		m.actor(spot.e1,"dragon","king",{deathEvent:q.event.killDragon});
		m.teleport(spot.t1,q.event.teleLairTown,'zone');
		
		m.actorGroup(spot.e2,25*30,[
			["bat","normal",2,{deathEvent:q.event.killMinion}],
			["bee","normal",3,{deathEvent:q.event.killMinion}]
		]);	
		m.actorGroup(spot.e2,25*30,[
			["mushroom","normal",2,{deathEvent:q.event.killMinion}],
			["larva","normal",3,{deathEvent:q.event.killMinion}]
		]);	
		
		
		m.block(spot.b1,q.event.viewBlock,'spike');
		
	} 
	a.loop = function(spot){} 
	return map;
};

exports.quest = q;





