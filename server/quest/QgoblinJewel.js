"use strict";
var s = require('./../Quest_exports').init('v1.0','QgoblinJewel');
var q = s.quest; var m = s.map; var b = s.boss;

q.name = "Goblin Jewel";

/*	### STEPS ###
talk ringo
get unf potion
get orc sock
get flower
make pot
transform
enter camp
kill 5 golbins
enter underground
open chest
leave underground
trigger boss
kill boss
leave camp
talk ringo
*/

/*	VARIABLE CONVENTION
got		got[ITEMID]			=> received item
kill 	kill[ENEMY CATVAR]	=> have killed (both bool and count)
item 	item[ITEMID]		=> use item
cs 		cs[CONTEXT]			=> cutscene
talk	talk[WHO ACTION]	=> talk done
*/

q.reward = {
	exp:{},
	item:{},
	passive:{min:0.1,max:0.5,mod:10},
};

q.challenge = {
	//speedrunner:s.challenge('speedrun','1:05:10.10'),
};

/*
q.requirement = [
	s.requirement('quest',"Qtest"),
	s.requirement('skill',"melee",1)
];
*/


q.variable = {
	killGoblin:0,
	killGoblinBoss:0,
	csInBoss:false,
	talkRingo:false,
	tgOnChest:false,
	haveFlower:false,
};

q.event = {
	_hint:function(key){
		if(s.haveItem(key,'jewel')) return 'Give Jewel to Ringo.';
		if(!s.get(key,'talkRingo')) return 'Talk to Ringo in Goblin Land.';
		if(!s.get(key,'haveFlower')) return 'Get Flower in Goblin Land.';
		if(!s.haveItem(key,'orc_sock') && !s.haveItem(key,'potion')) return 'Get Orc Sock in Goblin Land.';
		if(s.haveItem(key,'orc_sock') && !s.haveItem(key,'potion')) return 'Finish the potion.';
		if(s.haveItem(key,'potion') && !s.haveItem(key,'jewel')) return 'Enter Camp and steal Jewel.';
		return "BUG... :(";
	},
	_test:{
		signIn:function(key){
			
		},
		firstSignIn:function(key){
			s.teleport(key,'goblinLand','n1');
			s.setRespawn(key,'goblinLand','n1');
		}
	},	
	_signIn:function(key){
		/*
		if(s.haveItem(key,'jewel',1,true))
			s.teleport(key,'goblinLand','t3');
		*/
	},
	_start:function(key){
		
		
	},
	_abandon:function(key){
		s.teleport(key,'goblinLand','n1');
		s.setRespawn(key,'goblinLand','n1');
	},
	_complete:function(key){
		s.set(key,'_complete',true);
		s.setRespawn(key,'goblinLand','n1');
	},
	talkRingo:function(key){
		if(!s.get(key,'_active')){ s.startQuest(key); return; }
		if(!s.get(key,'talkRingo')){ s.dialogue(key,'ringo','intro','first'); return; }
		
		if(s.haveItem(key,'jewel')){ 
			if(s.get(key,'killGoblinBoss')) s.dialogue(key,'ringo','intro','second-postJewel'); 
			else s.chat(key,'bug, please send bug report. You can reset quest via the Quest Tab.');
			return; 
		}
		if(!s.haveItem(key,'potion')){  s.dialogue(key,'ringo','intro','second-prePotion'); return; }
		if(s.haveItem(key,'potion') && !s.haveItem(key,'jewel')){  s.dialogue(key,'ringo','intro','second-postPotion'); return; }
		
	},
	getPotionUnf:function(key){
		s.set(key,'talkRingo',true);
		s.addItem(key,'potion_unf');
	},
	getFlower:function(key){
		return s.testItem(key,'flower',1,true,'haveFlower');
	},
	killOrc:function(key,e){
		if(Math.random() < 0.50){
			s.drop(key,e,'orc_sock');
		}
	},
	itemPotionUnf:function(key){
		if(s.haveItem(key,{'potion_unf':1,'orc_sock':1,'flower':1},true)){
			s.addItem(key,'potion');
			s.chat(key,"You completed the potion by adding Orc socks and the Mystical flower.");		
		} else s.chat(key,"You don't have all the ingredients needed. (Orc socks and Mystical flower)");	
	},
	itemPotion:function(key){
		s.chat(key,"You will drink the potion upon entering the Goblin Camp.");
	},	
	teleInCamp:function(key){
		if(s.haveItem(key,'jewel')){ return	s.chat(key,"You already got the jewel."); } 
		
		if(s.haveItem(key,'potion')){
			s.chat(key,"You drank the potion and entered the camp."); 
			s.teleport(key,'goblinCamp@','t3');
		}
		else s.chat(key,"You don't want the goblins to be even more mad against human.");
	},
	killGoblin:function(key){
		s.set(key,"killGoblin",s.get(key,"killGoblin") + 1);
	},
	teleInUnderground:function(key){
		if(s.get(key,'killGoblin') >= 5){
			s.teleport(key,'goblinUnderground@','t1');
			s.setRespawn(key,'goblinUnderground@','t1',true);
		} else s.chat(key,"You should kill more goblins first to make them really angry with orcs.");
	},
	tgOnChest:function(key){
		s.set(key,'tgOnChest',true);
	},
	viewBlockChest:function(key){
		return !s.get(key,'tgOnChest');
	},
	getJewel:function(key){
		if(s.haveItem(key,'jewel')){ s.chat(key,'The chest is empty.'); return false; }
		return s.testItem(key,'jewel',1,true);
	},
	dontHaveJewel:function(key){
		return !s.haveItem(key,'jewel');
	},
	teleOutUnderground:function(key){
		if(s.haveItem(key,'jewel')) s.teleport(key,'goblinCamp@','t2');
		else s.chat(key,"You should get the jewel first.");
	},
	csTestBoss:function(key){
		if(s.get(key,'csInBoss') === false && s.haveItem(key,'jewel'))
			q.event.csInBoss(key);	
	},
	csInBoss:function(key){
		s.freeze(key);
		s.set(key,'csInBoss',true);
		s.dialogue(key,'goblin','intro','first');
		s.actor(key,'ej',q.id,'boss',{
			deathEvent:q.event.killGoblinBoss,
			tag:'boss',
			combat:0,
		});
		s.setTimeout(key,'csInBoss',3*25,q.event.csOutBoss);
	},
	teleInBossZone:function(key){
		s.teleport(key,'goblinCamp@','q4');
	},
	csOutBoss:function(key){
		s.unfreeze(key);
		var boss = s.getNpc(key,'boss');
		boss.combat = 1;
	},
	teleOutCamp:function(key){
		if(!s.haveItem(key,'jewel')) return s.chat(key,"You won't leave until you get that jewel or abandoning the quest.");
		if(s.get(key,'killGoblinBoss')){
			s.teleport(key,'goblinLand','t3');
			return s.setRespawn(key,'goblinLand','t3',true);
		}
		
		if(!s.getNpc(key,'boss')){	//aka have jewel, didnt kill boss but no boss cuz killed by others
			s.chat(key,"You haven't killed the boss yourself.");
			s.teleport(key,'goblinCamp','t4');
			s.set(key,'csInBoss',false);
			return;
		}
		
	},
	killGoblinBoss:function(key){
		s.set(key,'killGoblinBoss',true);
	},
	viewBlockBoss:function(key){
		if(s.getAct(key).type !== 'player') return true;
		return s.get(key,'csInBoss');		
	},
	questDone:function(key){
		s.completeQuest(key);
	}	
};	


q.event.testest = function(key){
	s.teamForEach(key,function(key){
		return true;
	},function(key){
		s.teleport(key,'goblinLand','ek');
	});
}

q.item['test'] = s.item('Potion','heal.pot',[
	['Drink',q.event.testest,'Transform into an orc.'],
]);

q.item['potion'] = s.item('Potion','heal.pot',[
	['Drink',q.event.itemPotion,'Transform into an orc.'],
]);
q.item['potion_unf'] = s.item('Unfinished Potion','heal.pot',[
	['Finish Potion',q.event.itemPotionUnf,'Requires 1 mystical flower and 1 orc socks.'],
]);

q.item['orc_sock'] = s.item('Orc Sock','defensive.speed');
q.item['flower'] = s.item('Mystical Flower','leaf.leaf');
q.item['jewel'] = s.item('Jewel','minimapIcon.loot');



q.npc["boss"] = {  //{
	"name":"Goblin",
	"sprite":{'name':"goblin",'sizeMod':1.2},
	"mastery":{'def':{'melee':1,'range':1,'magic':1,'fire':1,'cold':1,'lightning':1},
				'dmg':{'melee':1/6,'range':1/6,'magic':1/6,'fire':1/6,'cold':1/6,'lightning':1/6}},		//QUICKFIX
	"acc":0.5,
	"maxSpd":10,
	"moveRange":{'ideal':350,"confort":25,"aggressive":700,"farthest":700},	
	"abilityList":[],
	"boss":q.id+'-test',
	'target,maxAngleChance':10,
	'resource,hp,regen':0,
	'resource,hp,max':5000,
	'modAmount':false,
}; //}

q.dialogue['goblin'] = {'face':{'image':'bad-monster.0','name':'Ringo'},
	'intro':{
		'first':{
			'text':"Did you really think you could escape so easily? Prepare to die, orc!",
			'end':0,
			'option':[
				{'text':"Show me what you got, noob!"}
			],
		},
	}
}

q.dialogue['ringo'] = {'face':{'image':'villager-male.0','name':'Ringo'},
	'intro':{
		'first':{
			'text':"Hey! My name's Ringo! Guess what, I need your help! Wanna help me out real quick, man?",
			'exit':0,
			'option':[
				{'text':"Sure. Why not!",next:{node:'yes'}},
				{'text':"No.",next:{node:'no'}},
				{'text':"Skip.",next:{convo:'quest',node:'plan5'}},
			],
		},
		'no':{
			'text':"Ah, come on man. I need your help... I know you will change your mind someday. I'll be standing still until you do!",
		},	
		'yes':{
			'text':"There's a group of goblins north of here and they keep attacking my village. It's pissing me off.",
			'option':[
				{'text':"Why are they attacking the village?",next:{convo:'quest',node:'whyAttack'}},
				{'text':"What's your plan?",next:{convo:'quest',node:'plan'}},
			],
		},
		'second-prePotion':{
			'text':"Oh, you're back already!",
			'option':[
				{'text':"What am I supposed to do again?",next:{convo:'question',node:'pre-potion'}},
				{'text':"Where can I find orcs?",next:{convo:'question',node:'orc'}},
				{'text':"Where can I find a Mystical flower?",next:{convo:'question',node:'flower'}},
			],
		},
		'second-postPotion':{
			'text':"Oh, you're back already!",
			'option':[
				{'text':"What am I supposed to do again?",next:{convo:'question',node:'post-potion'}},
			],
		},
		'second-postJewel':{
			'text':"Oh my god! You did it! My plan worked! It's a miracle!",
			'option':[
				{'text':"Wait? You thought it wouldn't work?",next:{convo:'quest',node:'complete'}},
			],
		},
	},
	'quest':{
		'whyAttack':{
			'text':"Let just say that I 'borrowed' one of their precious jewels. And apparently, they didn't like it much... They get angry very easily, you know.",
			'option':[
				{'text':"Why don't you just give it back?",next:{node:'whyGiveBack'}},
				{'text':"What's your plan?",next:{node:'plan'}},
			],
		},
		'whyGiveBack':{
			'text':"Wait, what? What did I just say? Oh damn... I wanted to say that 'someone', which is obviously not me, 'borrowed' their jewel. But anyway, that's not the point, let's just change topic to something more important.",
			'option':[
				{'text':"Okay? So what's your plan?",next:{node:'plan'}},
			],
		},
		'plan':{
			'text':"I know for a fact that they own a second jewel. I didn't manage to steal it last time. Oh damn... I mean 'the thief' didn't manage to steal it last time.",
			'option':[
				{'text':"Continue",next:{node:'plan2'}},
			],
		},
		'plan2':{
			'text':"Anyway, I got a plan! A genius plan! My plan is so freaking smart that there's no way something could go wrong with it. Trust me, I'm an expert at this kind of stuff.",
			'option':[
				{'text':"Continue",next:{node:'plan3'}},
			],
		},
		'plan3':{
			'text':"You take the appearance of an orc then you steal by force the second jewel! That's so smart, right! The goblins will be soooo pissed off against orcs that they will attack them instead of us!",
			'option':[
				{'text':"That's a dumb plan...",next:{node:'planDumb'}},
				{'text':"That sounds like an AMAZING plan.",next:{node:'plan4'}},
			],
		},
		'planDumb':{
			'text':"Just trust me, my plans work every time, 25% of the time.",
			'option':[
				{'text':"...",next:{node:'plan4'}},
			],
		},
		'plan4':{
			'text':"Glad you like my plan! How couldn't you like it anyway, right? So, in order to take the appearance of an orc, you will first need to put your hands on a piece of orc and and on the Mystical Flower.",
			'option':[
				{'text':"And then what do I do?",next:{node:'plan5'}},
			],
		},
		'plan5':{
			'text':"Here take this unfinished potion. Once you got the orc clothing and the Mystical Flower, complete the potion and use it.",
			event:q.event.getPotionUnf,
			'option':[
				{'text':"Where can I find orcs?",next:{convo:'question',node:'orc'}},
				{'text':"Where can I find the Mystical Flower?",next:{convo:'question',node:'flower'}},
			],
		},
		
		'complete':{
			'text':"Oh, my plans are always genius. Most of the time, it's the humans involved that cause problems... Anyway, thanks again for your help. Bye.",
			'option':[
				{'text':"Wait what? Where's my reward?",next:{node:'complete2'}},
			],
		},
		'complete2':{
			'text':"What reward? I never talked about a reward, did I? Just give me the jewel already...",
			'option':[
				{'text':"No reward, no jewel.",next:{node:'complete3'}},
			],
		},
		'complete3':{
			'text':"Okay... Fine... Take those Passive Points.",
			'option':[
				{'text':"Thanks.",event:q.event.questDone},
			],
		},
	},
	'question':{
		'orc':{
			'text':"The orc village is located north east of here.",
			'option':[
				{'text':"Okay, thanks."},
			],
		},
		'flower':{
			'text':"Mystical flowers are huge white flowers that can normally be found near lakes. I'm sure you will find one in this area.",
			'option':[
				{'text':"Okay, thanks."},
			],
		},
		'pre-potion':{
			'text':"You need to complete the potion with a piece of orc and a Mystical flower.",
			'option':[
				{'text':"Okay, thanks."},
			],
		},
		'post-potion':{
			'text':"I can see you have the potion now. Use it and go in the Goblin village. Find the jewel and bring it back to me!",
			'option':[
				{'text':"Okay, thanks."},
			],
		},
	},
};


q.map.goblinLand = function(){
	var map = m.map();
	map.name = "Goblin Land";
	map.tileset = "v1.1";
	map.lvl = 0;
	map.grid = ["000000000000000000001100000000000000000000000022222220000000000000000000000000000001110000000000000000000000000000000000122222222221000000000000000000000000000000110000000000110000000000000000","000000000000000000001100000000000000000000000222222220000000000000000000000000000001110000000000000000000000000000000000122222222221000000000000000000000000000000110000000000110000000000000000","000000000000000000001100000000000000000000000222222200000000000000000000000000000001110000000000000000000000000000000000122222222221000111100000000000000000000000110000000000110111100000000000","000000000000000000001100000000000000000000000222222000000000000000000000000000000001110000000000000001111000000000000000122222222221000111100000000000000000000000110000000000110111100000000000","000000000000011110001100000000000000000000000222222000000000000000000000000000000001110000000000000001111000000000000000122222222221000111100000000000000000000000110000000000110111100000000000","000000000000011110001100000000111100000000000222222000000000000000000000000000000001110000000000000001111000000000000001111111111111100000000000000000000000000000110000000000110000000000000000","000000000000011110001100000000111100000000000222222000000000000000000000111100000001110000000000000000000000000000000000000000000000000000000000000011110000000001110000000000111000000000000000","000000000000000000001100000000111100022222222222222220000000000000000000111100000001110011110000000000000000000000000000000000000000000000000000000011110000000011110000000000111100000000000000","000111100000000000001100000000000000222222222222222222000000000000000000111100000001110011110000000000000000000000000001111111111111100000000000000011110000011111100000000000011111111100000000","000111100000000000001100000000000002222222222222222222200000000000000000000000000001110011110000000000000000000000000000122222222221000000000000000000000000111111000000000000001111111110111100","000111100000000000001100000000000022222222222222222222200000000000000000000000000001110000000000000000000000000000000000122222222221000000000000000000000001111111111000000000000111111111111100","000000000000000000001100000000000022222222222222222222200000000111100000000000000001110000000000000000000000000000000000122222222221000000000000000000000001111101111000000000000011111111111100","000000000000000000001100000000000022222222222222222222200000000111100000000000000001110000000000000000000000000000000000122222222221000000000000000000000001100001111000000000000000000011000000","000000000000000000001100000000000022222222222222222222200000000111100000000000000001110000000000000000000000000000000000122222222221000000000000000000000001100000000000000000000001111011000000","000000000000000000001100000000000222222222222222222222200000000000000000111100000001110000000000000000000000000000000000122222222221000000000000000110000001100000000000000000000001111011000000","000000000000000000001100000000002222222222222222222222200000000000000000111100000001110000000000000000000000000000000000122222222221000000000000000110000001100000000000000000000001111011000000","000000000000000000001100011110002222222222222222222222200000000000000000111100000001110000000000000000000000000111100000122222222221000000000000000000000001100000000000000000000000000011000000","000000000000000000001100011110002222222222222222222222200000000000000000000000000011110000000000000000000000000111100000122222222221011110000000000000000001100000000000000000000000000011000000","000000000000000000001100011110002222222222222222222222201111000000000000000000000111110000000000000000000000000111100000122222222221011110000000000000000001100000000000000000000000000011000000","000000000000000000001100000000002222222222222222222222201111000000000000000000001111100000000000000000000000000000000000122222222221011110000000000000000001100000000000000000000000000011000000","000000000001111000001100000000002222222222222222222222201111000000100010000000011111000000000000000000000000000000000000122222222221000000000000000000000001100000000000000000000000000011000000","000000000001111000001100000000002222222222222222222222200000000011100011111111111111111000000000011000000000000000000000122222222221100000000000000000111101100000000000000000000000000011000000","011110000001111000001100000000002222222222222222222222000000000111100011111111111101111000000000100100000000000000000000122222222222110000000000000000111101100000000000000000000000000011000000","011110000000000000001100000000002222222222222222222222000000001111100011111111111001111000000001111110000000000000000000122222222222211000000000000000111101100000000000000000000000000011000000","011110000000000000001100000001111222222222222222222222000000011111100011111111110000011111111001111110000000000000000000122222222222221000000000000000000001100001111100000000000000000011000000","000000000000000000001100000001111022222222222222222222000000011111100011111111100000011111111001111110000001100000000000122222222222221000000000000000000001100010000010000000000000000011000000","000000000000000000001100000001111002222222222222222220000000011100000000000000000000011111111001000010000001100000000000012222222222221000000000000000000001100100000001000000000000000011000000","000000000000000000001100000000000000002222222222200001111000011100000000000000000000000000011111000010000000000000000000001222222222221000000000000000000001100100000001000000000000000011000000","000000000000000000001100000000000000000222222222000001111000011100000000000000000000000000011111000010000000000000000000000122222222221000000000000000000001100110000011000000000000000011000000","000000000000111100001110000000000000000222222222000001111000011100000000000000000000000000011111011010000000000000000000000122222222221000000000000000000001100011000110000000000000000011000000","001110000000111100001111000000000000000111111111000000000000111100000000000000000000000000000001011010111100000000000000000122222222221000011110000000000001100001111100000000000000000011000000","011111000000111100001111111111000000000111111111000000000001111100000000000000000000111100000001000010111100000000000000000122222222221000011110000000000001100000111000000000000000000011000000","110001100000000000000111111111100000000111111111000000000011111000000000000000000000111100000001000010111100000000000000000122222222221000011110000000000001111110000000000000000000000011000000","100000110000000000000011111111110000000000000000000000000111110000000000000000000000111100000001000010000000000000000011110122222222221000000000000000000001111110000000000000000000000011000000","110001110000000000000001111111111000000000000000000000001111100000000000000000000000000000000001000001111111110000000011110122222222221000000000000000000001111110000000000000000000000011000000","111011110000000000000000111111111111111111111111111111111111000000000000000000000000000000000001000000000000001000000011110122222222221000000000000000000001111110000000000000000000000011000000","111111100000000000000000000000111111111111111111111111111110000000000000000000000000000000000001100000000001101000000000000122222222221000000000000000000001111110000000000000000000000011000000","011111000000000000000000000000011111111111111111111111111100000000000000000000000000000000000001111111111101101000000000000122222222221000000000000000000001111110000000000000000000000011000000","001110000000000000000000000000001111111111111111111111111000000000000000000000000000000000000000111111111110001000000000000122222222221000000000000000000001100000000000000000000000000011000000","000100000000011110000000000000000111111111111111111111110000000000000000000000000000000000000000000000000010001000000000000122222222221000000000000000000001100000000000000000000000000011001111","000000000000011110000001111111111111111111111111111111111111111111111111111100000000000000000000000000111110001000000000000122222222221000000000000000000001100000000000000000000000000011001111","000000000000011110000011111111111111111111111111111111111111111111111111111110000000000000000000000000111110001000000000000122222222221000000000000000000001100000000000000000000000000011001111","000111100000000000000111111111111111111111111111111111111111111111111111111111000000000000000000000000111110001000000000000122222222221000110000000000000001100000000000000000000000000011000000","000111100000000000000111111111111111111111111111111111111111111111111111111111000000000000000000000000000011011000000000000122222222221000110000000011110001100000000000000000000000000011000000","000111100000000000000110000000000000000000000000000000000000000000000000000011000000000000000110000000000011111000000110000122222222221000000000000011110001100000001100000000000000000011000000","000000000000000000000110000000000000000000000000000000000000000000000000000011000000000000000110000000000001110000000110000122222222221000000000000011110001100000001100000000000000000011000000","000000000000000000000110000000000000000000000000000000000000000000000000000011001100000000000000000000000000000000000000000122222222221000000000000000000001100000000000000000000000000011000000","000000000110000000000110000100000000000000000000000000000000000000000000000011001100000000000000000000000000000000000000000122222222221000000000000000000001100000000000000000000000111111000000","000000000110000000000110000100000000000000001110000000000000011000000110000011000000000000000000000000000000000000000000000111111111111000000000000000000001100000000000000000000001000001000000","000000000000000000000110000000000000000000001110000000000000011011110110000011000000000000000000000000000000000000000000000111111111111000000000000000000001100000000000000000000010000001000000","000000000000000000001110000000000000000000001110000000000000000011110000000011000000000000000000000000000000000000000000000111111111111000000000000000000011100000000000000000000010000001000000","000000000000000000011110000000000000000000000000000000000000000011110000000011000000000000000000000000000000000000000000001112222222211100001000001000000111100000000000000000000011000001000000","000000000011111111111100000000000000000000000000000000000000000000110000000011000000000000000000000000000000000000000001111112222222211111111000001111111111000000000000000000000001100001000000","000000000111111111111000000000000000000000000000000000000000000000110000000011000000000000000000011110000000000000000011111122222222221111111000001111111110000000000000000000000000111111000000","000000001111111111110000000000000000000000000000000000000000000000000000000011000000000000000000011110000000000000000111111222222222222111111000001111111100000000000000000000000000011111000000","110000001111111111100000000000000000000000000000000000000000000000000000000011000000000000000000011110000000000000001111110222222222222211111000001111111011110000000000000000000000000011000000","110000001100011111100000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000011110000222222222222200000000000000000011110000000000000000000000000011001100","000000001100011111100000000000000000000001111111000000000000000000000000000011000000000000000000000000000000000000111100000222222222222200000000000000000011110000000000000000000011110011001100","000000001101111000000000000000000000000010000000100000000000000000000000000011000000000000000000000000000000000001111011110222222222222200000000000011110000000000000000000000000011110011000000","000000001101111000000000000000000010000010011110100000000000000000000000000011000000000111100000000000000000000011110011112222222222222200000000000011110000000000000000000000000011110011000000","000000001101111111100000000110000010000010011110100000000000000000000000000011000000000111100000000000000000000011100011112222222222222200000000000011110000000000000000000000000000000011000000","000000001101111111100000000110000000000010011110100000000000000000000000000011000000000111100000000011000000000011000000002222222222222200000000000000000000000000000000000110000000000011000000","000000001100000111100000000000000000000010000000100000000000000100000110000011000000000000000000000011000000000011000000002222222222222200000000000000000000000000000000000110000000000011000000","000000001100000111100000000000000000000011000001100000000000000100000110000011000000000000000000000000000000000011000000002222222222222200000000000000000000000000000000000000000000000011000000","000000001100111100000000000000000000000011111111100000000000000000000000000011000000000000000000000000000000000011000000022222222222222200000000000000000000000000000000000000000000000011000000","000000001100111100000000000000000000000001111111000000000000000000000000000011000000000000000000000000000000000011011110022222222222222200000000000000000000000000000000000000000000000011000000","000000001100111100000000000000000000000000000000000000000000000000000000000011000011000000000000000000000000000011011110022222222222222200000000000000000000000000000000000000000000000011000000","000000001100111100000000000000000000000000000000000000000000000000000000000011000011000000000000000011111000000011011110022222222222222200000000000000000000000000000000000000000000000011000000","000000001100000000000000000000000000000000000000001000000000000000000000000011000000000000000000000111111100000011000000022222222222222000000000000000000000000000000000000000000000000011000000","000000001100000111100000000000000000000000000000001000000000000000000000000011000000000000000000001100000110000011000000022222222222222000000000000000000000000111100000000111111111111110000000","000000001101100111100000000000000000000000000000000000000000000000000000000011000000000000000000011000000011000011000000222222222222222000000000000000000000000111100000001111111111111100000000","000000001101100111100000000000000000000011110000000000000000000000000000000011000000000000000000011000110011000011000000222222222222220000000000000000000000000111100000011000000000000000000000","000000001100000111100000000000000000000011110000000000000000000000000000000011000000000000000000011000110011000011000000222222222222220000000000000000000000000000000000110000000000000000000000","011110001100000000000000000000000000000000000000000000000000000000000000000011000000000000000000011000000011000011000000222222222222220000000000000000000000000000000000110000000000000000000000","011110001100110000000000000000000000000000000000000000000000000000000000000011000000000000000000011000000011000011000000222222222222220000000000000000000000000000000000110000000000000000000000","011110001100110000000000000000000000000000000000000000000000000000000000000011000000000000000000011000000011000011000000222222222222220000000000000000000000000000000000110001111000000000000000","000000001100000000110000010000000000000000000000000000000000000000000000000011000000001111111111110000000011000011000000222222222222220000000000111100000000000000000000110001111000000000000000","000000000110000000110000010000000000000000000000000000000000000000000000000011000000011111111111100001100011000011000000222222222222200000000000111100000000000000000000110001111000000000000000","000000000011000000000000000000000000000000000000000000000000000000000000111011000000110011000000000001100011000011000002222222222222200000000000111100000000000000000000110000000000000111100000","000000000001100000000000000000000000000000000000000000000000000000000000111011000001100011000000000000000011000011000002222222222222200000000000000000000000000110000000110000000000000111100000","000000000000110000000000000000000000000000000000011000000000000000000000111011000001100000000110000000000011000011000002222222222222200000000000000000000000000110000000110000000000000111100000","000000000000011000000000000000000000000000010000011000000000000000000000111011000001100000000110000110000011000011000002222222222222200000000000000000000000000000000000110000000000000000000000","000000000000001100000000000000000000000000010000000000000000000000000000111011000001100000000000000110000011000011000002222222222222200000000000000000000000000000000000111000000000000000000000","000000000000000110000000000000000000000000000000000000000000000000000000111011000001110000000000000000000111000011000022222222222222200000000000000000000000000000000000111100000000000000000000","001111000000000011000000000000000000000000000000000000000000000000000000000011000001111000000000000000001111000011000022222222222222200000000000000000000000000000000000011111111111111111100000","001111000000000001100000000000000000000000000000000000000000000000000000000011000000111111111111111111111110000011000022222222222222200000000000000001100000000000000000001111111111111111110000","001111000000000000111111111111111111111111111111111110000000000000000111111110000000011111111111111111111100000011000022222222222222200000000000000001100000000000000000000111111111111111111000","000000000000000000011111111111111111111111111111111111000000000000001111111100011110001111111111111111111000000011000222222222222222200000000000000000000000000000000000000011111111111111111000","000000000000000000000000000000000000000111111111111001100000000000011000000000011110000111111111111111110000110011000222222222222222200000000000000000000000001111000000000000000000000000011000","000000000000000000000000000000000000001000000000000100111110000011110000000000011110000000000000000000000000110011000222222222222222200000000000000000000000001111000000000000000000001111011000","000000000000000011110000000000000000001100000000001100111111000111110000000000000000000000000000000000000000000011000222222222222222200000000000000000000000001111000000000000000000001111011000","000000000000000011110000000001100000001111111111111100111111000111111000000000000000000000000000000000000000000111002222222222222222200000000000000000000000000000000000000000000000001111011000","000000000000000011110000000001100000000111111111111000110000000000111100000000000000000000000000000000000000001111002222222222222222200000000000000000000000000000000000000000000000000000011000","000001111000000000000000000000000000000000000000000001110000000000011111111111111111111111111111111111111111111110002222222222222222200000000000000000000000000000000000000000000000000000011000","000001111000000000000000000000000000000000000000000011110000000000001111111111111111111111111111111111111111111100002222222222222222200000000000000000000000000000011110000000000000000000011000","000001111000011000000000000011111111111111111111111111100000000000000111111111111111111111111111111111111111111000002222222222222222200000000000000000000000000000011110000000000000000000011000","000000000000011000000000000111111111111111111111111111000000000001111011111111111111111111111111111111111111110000002222222222222222200011000000000000000000000000011110000000000000000000011000","000000000000000000000000001111111111111111111111111110000000000001111000000000000000000000000000000000000000000000002222222222222222200011000000000000000000000000000000000000000000001111011000","011000000000000000000000011111111111111111111111111100000000000001111000000000000000000000000000000000000000000000002222222222222222200000000000000000000000000000000000000000000000001111011000","011000000000000000000000011111111111111111110000000000000000000000000000000000000000000000000000000000000000000000002222222222222222220000000000000000000000000000000000000000000000001111011011","000000000000000001111000011011111111111111110000000000000000000000000000000000000001111111111111111000000000000000002222222222222222220000000000000000000000000000000000000000000000000000011011","000000000000000001111000011011110111111111110000000011110000000000000000000000000010000000000011100100000000000000002222222222222222220000000000000000000000000000000000000000000000000000011000","000000000000000001111000111111111111111111111100000011110000000000000000011000000100011110000011100010000000000000002222222222222222222000000000000000000000000000000000000000000000000000011000","000000001111000000000001111111111111111111111100000011110000000000000000011000000100011110000011100010000000000000002222222222222222222000000000000000000000000000000000000000000000000000011000","000000001111000000000011111111111111111111111100000000000000000000000000000000000100011110000011100010001111000000022222222222222222222200000000000000000000000000000000000000000000000000011000","000000001111000000000111111111111111111111110000000000000000000000000000000000000110011110000000000110001111000000022222222222222222222200000000000000000000000000000000000000000000000000011000","000000000000000000001111111111111111111111110000000000000000000000000000000000000011000000000000001100001111000000022222222222222222222200000000000000000000000000000000000000000000000000011000","000000000000000000011110111111111111111111110000000000000000000000000000000000000001111111111111111000000000000000022222222222222222222220000000000111100000000000000000000000000000000000011000","000000000000000000111111111111111100000000000000000000000000000000000000000000000000111111111111110000000000000000022222222222222222222220000000000111100000000000000000000000000000000000011000","000000000000000000111011111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000022222222222222222222222000000000111100000000000000000000000000000000000011000","000000000000000000110011111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000022222222222222222222222000000000000000000000000000000000000001111000000011000","000000000000000000111111111111110000000000000000000000000000000000000000000000000000000000000000000000001111000000022222222222222222222222200000000000000000000000000000000000001111000000011000","110000000000000000111111111111110000000000000000110000000000000000000000000000000000000000000000000000001111000000002222222222222222222222200000000000000000000000000000000000001111000000011000","110000000000000000111111111111110000000000000000110000000000000000000000000000000000000000011000000000001111000000002222222222222222222222200000000000000000000000000000000000000000000000011000","110000000000000000110011111111000000000000000000000000000000000000000000000000000000000000011000000000001111000000002222222222222222222222220000000000000000000000000000000000000000000000011000","000000000000000001110011111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000222222222222222222222220000000000000000000000000000000000000000011111110000","000000000000000011110011111111000000000011100000000000000000000000000000000000000000000000000000000000000000000000000222222222222222222222222000000000000000000000000000000000000000111111100000","000001111111111111100000111100000000000011100000000000000000000000000000000000000000000000000000000000000000000000000022222222222222222222222000000011110000000000000000000000000001100000000000","000011111111111111000000111100000000000011100000000000000000000000000000000000000000000000000000000000000000000000000022222222222222222222222200000011110000000000000000000000000011001110000000","000111111111111110000000111100000000000011100000000000000000111100000000000000000000000000000000000000000000000000000002222222222222222222222200000011110000000000000000000000000011001110000000","000111111111111100000000000000000000000000000000011110000000111100000000000000000000000000000000000000000000000000000002222222222222222222222200000000000000000000000000000000000011001110000000","000110000000000000000000000000000000000000000000011110000000111100000001111000000000000000000000000000000000000000000000222222222222222222222220000000000000000111100000000000000011001110000000","000111111111100000000000000000000000000000000000011110000000000000000001111000000000000000000000000000000000000000000000222222222222222222222220000000000000000111100000000000000011000000000000","000111111111100000000000000000000000000000000000000000000000000000000001111000000000000000000000000000000000000000000000022222222222222222222222000000000000000111100000000000000011000000111100","000111111111100000000000000000000000000000000000000000000000000000000111111110000000000000000000000000000000000000000000000222222222222222222222000000000000000000000000000000000011000000111100","000111111000000000000000000000000000000000000000000000000000000000000111111110000000000000000000000000000000000000000000000022222222222222222222200000000000000000000000000000000011100000111100","000111111000000000000000000000000000000000000000000000000000000000000111111110000000000000000000111100000000000000000000000022222222222222222222200000000000000000000000000000000011110000000000","000111111000000000111100000000000000000000000000000000000000000000000000011110000000000000000000111100000000000000000000000002222222222222222222220000000000000000000000000000000001111110000000","000110000000000000111100000000000000000000000000000000000000000000000000011110000000000000000000111100000000000000000000000002222222222222222222220000000000000000000000000000000000111111000000","000110000000000000111100000000000000000000000000000001111000000000000000011110000000000000000000000000000000000000000000000000222222222222222222220000000000000000000000000000000000011111100000","000110000000000000000000000000000000011110000000000001111000000000000000000000000000000000000000000000000000000000000000000000222222222222222222222000000000000000000000000000000000001111100000","000110000000000000000000000000000000011110000000000001111000000000000000000000000000000000000000000000000000000000000000000000222222222222222222222000000000000000000000000000000000000001100000","000110000000000000000000000000000000011110000000000000000000000000000000000000000000000000000000000000000000000000000000111100022222222222222222222200000000000000000000000000000000000001100000","000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111100000000000000000111100022222222222222222222200000000000000000000000000000000000001100000","000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111110000000000000000111100022222222222222222222220000000000000000000000000000000000001100000","000110000000000000011110000000000000000000000000000000000000000000000000000000000000000000011000000000011000000000000000000000002222222222222222222222200000000000000000000000000000000001100000","000110000000000000011110000000000000000000000000000000000000000000000000000000000000000000110000000000001100000000000000000000002222222222222222222222220000000000111100000000000000000001100000","000110000000000000011110000000000000000000000000000000000000000000000000000000000000000000110000000000001100000000000000000000002222222222222222222222220000000000111100000000000000000001100000","000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000001100000000000000000000002222222222222222222222220000000000111100000000000000000001100000","000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000001100000000000000000000002222222222222222222222222000000000000000000000000000000001100000","000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000001100000000000000000000002222222222222222222222222000000000000000000000000000000001100000","000110000000000000000000000000000000000000000000000000000000000000000111000000000000000000110000011110001100000000000000000000002222222222222222222222222200000000000000000000000000000001100000","000110011110000000000000000000000000000000000000000000000001111000000111000000011111111111100000011110001100000000000000000000002222222222222222222222222200000000000000000000000000000001100000","000110011110000000000000000000000000000000000000000000000001111000000111000000111111111111000000011110001100000000000000000000002222222222222222222222222220000000000000000000000011110001100000","000110011110000000000000000000000000000000000000000000000001111000000111000001100000000000000000000000001100011000000000000000002222222222222222222222222220000000000000000000000011110001100000","000110000000000000000000000000000000000000000000000000000001111000000000000011000000000000000000000000001100011000000000011110000222222222222222222222222222000000000000000000000011110001100000","000110000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000001100000000000000011110000222222222222222222222222222000000000000000000000000000001100000","000110000000001111000000000000000000000000110000000000000000000000000000000011000011110000000000000000001100000000000000011110000022222222222222222222222222000000000000000000000000000001100000","000110000000001111000000000000000000000000110000000111111111111111111111111110000011110000000000000000001100000000000000000000000022222222222222222222222222000000000000000000000000000001100000","000110000000001111000000000000000000000000000000001111111111111111111111111100000011110000000000000000001100000000000000000000000002222222222222222222222222200000000000000000000000000001100000","000110000000000000000000000000000000000000000000011000000000000000000000000000000000000000000001111000001100000000000000000000000002222222222222222222222222200000000000000000000000000001101111","000110000000000000000000000000000111100000000000110000011110000000000000000000000000000000000001111000000111111000000000000000000000222222222222222222222222220000000000000000000000000001101111","000110000000000000000000000000000111100000000000110000011110000000000000000000000000000000000001111000000011111100000000000000000000000222222222222222222222220000000000000000000000000001101111","000110000000000000000000000000000111100000000000110000011110000000000000000000000000000000000000000000000000000110000000000000000000000222222222222222222222220000000000000000000000011101100000","000110000000000000000000000000000000000000000000110000011110001111000000000000000000000000000000000000001111000011000000000000000000000222222222222222222222222000000000000000000000011101100000","000110000000000000000000000000000000000111100000110000000000001111000000000001111000000001111000000000001111000011000000000000000000000022222222222222222222222000000000000000000000011101100000","000110000000000000000000000000000000000111100000110000000000001111000000000001111000000001111000000000001111000011000000000000000000000011111111111111111111111111100000000000000000011101100000","000110000000000000000000000011100000000111100000110000000000000000000000000001111000000001111000000000001111000111000000000000000000000000000000000000000000000000000000000000000000000001100000","000110000000000000000000000011100000000111100000111000000000000000000000000000000000000000000000000000000000001111000000000000000000000000000000000000000000000000000000000000000000000001100000","000110000000000000000000000011100000000111100000111100001111000000000000000000000000000000000000000000011111111110000000000000000000000000000000000000000000000000000000000000000000000001100000","000110000000000000000000000011100000000111100000011110001111111100000011110000000000000000000000000000111111111100000000000000000000000000000000000000000000000000000000000000000000000001100000","000110000000000000000000000000000000000000000000001111001111111100000011110000000000000000000000000001111111111000000000000000000000000000000000000000000000000000000000000000111100000001100000","000110000000000000000000000000000000000000000000000111100000111100000011110000000000000000000000000011111111110000000000000000000000000000000000000000000000000000000000000000111100000001100000","000110000000000011110000000000000000000000000000000011110000000000000000000000000000000000000000000111100000000000000000000000000000000011111111111111111111111111100000000000111100000001100000","000110000000000011110000000000000000000000000000000001111111111111111111111111000000001111000000001111000000000000000000000000000000000000222222222222222222222222200000000000000000000001100000","000110000000000011110000000000000000000000000000000000111111111111111111111111100000001111000001111110000000000000000000000000000000000000222222222222222222222222200000000000000000000001100000","000110000000000000000000000000000000000000000000000000011111111111111111111111110000001111000011111100000000000001111000000000000000000000022222222222222222222222200000000000000000000001100000","000110011110000000000000000000000000000001111000000000001111111111111111111111111000000000000111111000000000000001111000000000000000000000022222222222222222222222220000001111111111111111000000","000110011110000000000000000000000000000001111000000000000000000000000000000000111100000000000111110000000000000001111000000000000000000000002222222222222222222222220000011111111111111110000000","000110011110000000000000000000000000000001111000000000000000000000000000011110011110000000000110000000011110000000000000000000000000000000002222222222222222222222220000110000000000000000000000","000110000000000000000000000000000000000000000000000000000000000000000000011110001111000000000110000000011110000000000000000000000000000000002222222222222222222222222001100000000000000000110000","000110000000000000000000000000000000000000000000000000000000000000000000011111111111100000001110000000011110000000000000000000000000111100002222222222222222222222222201100000000000000000110000","000110000000000000000000000000000000000000000000000000000000000000000000000001111011110000011110000000000000000000000000000000000000111100000222222222222222222222222221100000011110000000000000","000110000000000000000000000000000000000000000000000000000000000000000000000001111001111000111101111000000000111100001100000000000000111100000222222222222222222222222221100000011110000000000000","000110000000000000000000000000110000000000000000000000000000000000000000000000000000111111111000011000000000111100001100000000000000000000000222222222222222222222222221100000011110000000000000","000110000000000000000000000000110000000000000000000000000000000000000000000000000000011111110000011000000000111100000000000000000000000000000222222222222222222222222221100000000000000000000000","000110000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111110000000111100000000000000000000000000000222222222222222222222222221100000000000000000000000","000011111111111111111111111111000000000000000000000000000000000000000000000000000000000111111111111110000000000000000000000000000000000000000222222222222222222222222221100000000000000000000000","000001111111111111111111111111100000000000000000000000000000000000000000000000000000000001111111111110000000000000000000000000000000000000000222222222222222222222222221110000000000000000000000","000000000000000000000000000000110000000000000000000000000000000000000000000000000000000111111111111111100000000000000000000000000000000000000222222222222222222222222221111000000000000001111000","000000000000000000000000000000011000000000000000000000000000000000000000000000000000000111111111111111100000000000000111100000000000000000110022222222222222222222222222111100000001100001111000","000000000000001111000000000000011000011100000000000000000000000000000000000000000000000111111111111111100000000000000111100000000000000000110022222222222222222222222222211110000001100001111000","000000000000001111000001111000011000011100000000000000000000001111000000000000000000000001111111111111111000000000000111100000000000000000000002222222222222222222222222221111000000000000000000","000000111100001111000001111000011000011100000000000000000000001111000000000000000000000001111111101111111000000000000000000000000000000000000002222222222222222222222222222111100000000000000000","000000111100000000000001111000011000011100000000000000000000001111000000000000000000000001111111101111111000011000000000000000000000000000000002222222222222222222222222222211110000000000000000","000000111100000000000000000000011000000000000000000000000000000000000000000000000000000000011111111111111110011000000000000000000000000000000000222222222222222222222222222221111000000000000000","000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000011110111111111110000000000000000000000000000000000000222222222222222222222222222222111000000000000000","000000000000111100000000000000001111111111111111111111111111000000000000000000000000000000011110111111111110000000000000000000000000000000000000022222222222222222222222222222211000000000000000","000000000000111100000000000000000111111111111111111111111111100000000000000000000000000001111111111111111000000000000000000000000000000000000000022222222222222222222222222222211000000000000000","000000000000111100000000000000000000000000000000000000000000110000000000000000000000000001111111111111111000000000000000000000000000000000000000002222222222222222222222222222211000000000000000","000000000000000000000000000000000000000000000000000000000000011000000000000000000000000001111111111111111001100000000000000000000000000000000000000222222222222222222222222222211000000000110000","000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000011111111111111111111000000000000000000000000000000000000222222222222222222222222222211000000000110000"]
	
	var a = map.addon[q.id] = {};
	a.spot = {"s1":{"x":816,"y":240},"ed":{"x":3248,"y":368},"q1":{"x":2192,"y":560},"ek":{"x":5424,"y":560},"ec":{"x":4624,"y":784},"ef":{"x":2640,"y":1232},"e1":{"x":5552,"y":1264},"g3":{"x":4464,"y":1488},"t2":{"x":1456,"y":1584},"eh":{"x":1616,"y":1680},"ee":{"x":3408,"y":1744},"t4":{"x":1872,"y":1872},"b2":[1568,2400,1920,1920],"q4":{"x":1872,"y":2032},"b3":[1472,1472,2112,2720],"ei":{"x":912,"y":2224},"eg":{"x":1808,"y":2352},"q2":[1600,2400,2432,2720],"ej":{"x":1968,"y":2576},"b1":[1792,2080,2848,2848],"t3":{"x":1968,"y":2928},"b4":[1792,2080,2976,2976],"eb":{"x":4944,"y":2992},"e6":{"x":2768,"y":3888},"ea":{"x":5296,"y":4080},"s3":{"x":4912,"y":4144},"e5":{"x":1616,"y":4240},"e4":{"x":656,"y":4528},"e7":{"x":3696,"y":4624},"e8":{"x":5456,"y":4912},"g2":{"x":4208,"y":4944},"e3":{"x":1104,"y":5264},"g1":{"x":1744,"y":5488},"n1":{"x":2096,"y":5520},"s2":{"x":4304,"y":6000},"t1":{"x":2576,"y":6096}}
	a.path = {blue:[{"x":1800,"y":5550},25,{"x":1700,"y":5300},50,{"x":1500,"y":5100},],};
	
	a.load = function(spot){
		//Quest
		m.actor(spot.n1,"npc","regular",{
			name:'Ringo',
			'sprite,name':"villager-male0",
			angle:90,
			nevermove:1,
			dialogue:q.event.talkRingo,
		});

		m.loot(spot.q1,'!haveFlower',q.event.getFlower,"flower");
		
		m.actorGroup(spot.e1,25*15,[
			["orc","melee",2,{deathEvent:q.event.killOrc}],
			["orc","range",1,{deathEvent:q.event.killOrc}],
		]);	
		m.actorGroup(spot.ek,25*15,[
			["orc","magic",3,{deathEvent:q.event.killOrc}],
		]);	
				
		m.block(spot.b1);
		
		m.teleport(spot.t3,q.event.teleInCamp,"zone",{angle:270});
		
		
		//Extra
		m.waypoint(spot.g1);
		m.waypoint(spot.g2);
		m.waypoint(spot.g3);
			
		
		m.actorGroup(spot.e4,25*15,[
			["bee","normal",3],
		]);	
		
		m.actorGroup(spot.e5,25*15,[
			["bee","normal",2],
			["mosquito","normal",1],
		]);	
		
		
		m.actorGroup(spot.e6,25*15,[
			["bat","normal",3],
			["plant","normal",1],
		]);		
		
		m.actorGroup(spot.e7,25*15,[
			["larva","normal",4],
			["mushroom","normal",1],
		]);	
		
		m.actorGroup(spot.e8,25*15,[
			["bat","normal",2],
		]);	
		
		m.actorGroup(spot.ea,25*15,[
			["larva","normal",2],
			["plant","normal",2],
		]);		
		
		m.actorGroup(spot.eb,25*15,[
			["larva","normal",4],
		]);	
		
		m.actorGroup(spot.ec,25*15,[
			["mushroom","normal",2],
			["mosquito","normal",1],
		]);			
		
		m.actorGroup(spot.ed,25*15,[
			["plant","normal",6],
		]);	
		
		m.actorGroup(spot.ef,25*15,[
			["mushroom","normal",1],
			["bat","normal",2],
		]);	
		
	}
	
	a.loop = function(spot){
	
	}
	
	return map;
};

q.map.goblinCamp = function(){
	var map = m.map();
	map.name = "Goblin Land";
	map.tileset = "v1.1";
	map.lvl = 0;
	map.graphic = 'goblinLand';
	
	var a = map.addon[q.id] = {};
	a.spot = {"q4":{"x":1856,"y":2016},"t4":{"x":1856,"y":1856},"s1":{"x":816,"y":240},"ed":{"x":3248,"y":368},"q1":{"x":2192,"y":560},"ek":{"x":5424,"y":560},"ec":{"x":4592,"y":1200},"ef":{"x":2640,"y":1232},"e1":{"x":5552,"y":1264},"t2":{"x":1456,"y":1584},"eh":{"x":1616,"y":1680},"ee":{"x":3408,"y":1744},"b2":[1568,2400,1920,1920],"b3":[1472,1472,2112,2720],"ei":{"x":912,"y":2224},"g2":{"x":3728,"y":2320},"eg":{"x":1808,"y":2352},"q2":[1600,2400,2432,2720],"ej":{"x":1968,"y":2576},"b1":[1792,2080,2848,2848],"t3":{"x":1968,"y":2928},"b4":[1792,2080,2976,2976],"eb":{"x":4944,"y":2992},"e6":{"x":2768,"y":3888},"ea":{"x":5296,"y":4080},"s3":{"x":4912,"y":4144},"e5":{"x":1616,"y":4240},"e4":{"x":656,"y":4528},"e7":{"x":3696,"y":4624},"e8":{"x":5456,"y":4912},"e3":{"x":1104,"y":5264},"g1":{"x":1744,"y":5488},"n1":{"x":2096,"y":5520},"s2":{"x":4304,"y":6000},"t1":{"x":2576,"y":6096}}
	a.path = {};
	
	a.load = function(spot){
					
		m.block(spot.b2,q.event.viewBlockBoss,true);
		m.block(spot.b3,q.event.viewBlockBoss,true);
		m.block(spot.b4);
		
		m.teleport(spot.t3,q.event.teleOutCamp,"zone",{angle:90});
		m.teleport(spot.t4,q.event.teleInBossZone,"zone",{angle:90,viewedIf:q.event.viewBlockBoss});
		
		m.teleport(spot.t2,q.event.teleInUnderground,"well",{angle:90});
		
		m.actorGroup(spot.ei,25*300,[
			["goblin","melee",1,{deathEvent:q.event.killGoblin}],
			["goblin","range",1,{deathEvent:q.event.killGoblin}],
		]);	
		
		m.actorGroup(spot.eh,25*300,[
			["goblin","magic",1,{deathEvent:q.event.killGoblin}],
			["goblin","range",1,{deathEvent:q.event.killGoblin}],
		]);	
		
		m.actorGroup(spot.eg,25*300,[
			["goblin","range",1,{deathEvent:q.event.killGoblin}],
		]);	
	
	}
	
	a.loop = function(spot){
		m.collision(spot.q2,q.event.csTestBoss);	
	}
	a.playerLeave = function(key){
		s.setSprite(key,'regular');
	}
	a.playerEnter = function(key){
		s.setSprite(key,'orc-melee');
	}
	return map;
};

q.map.goblinUnderground = function(){
	var map = m.map();
	map.name = "Goblin Underground";
	map.graphic = "goblinUnderground";
	map.lvl = 0;
	map.tileset = "v1.1";
	map.grid = ["00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000111111100000000000","00000000000000000000000000000001111111110000000000","00000000000000000000000000000011111111111000000000","00000000000000000000000000000011111111111000000000","00000000000000000000000000000011000000011000000000","00000000000000000000000000000011011111011000000000","00000111111111111111111110000011011111011000000000","00001111111111111111111111000011011111011000000000","00011111111111111111111111100011000000011000000000","00011111111111111111111111100011000000011000000000","00011000000000000000011001100011000000011000000000","00011000000000000000011001100011000000011000000000","00011000000000000000000001110111000000011000000000","00011000000000000000000001111111000000011000000000","00011000000000000000000000111110000000011000000000","00011000000000000000000000011100000000011000000000","00011000000011000000000000001000000000011000000000","00011000000011000000000000000000000000011000000000","00001111111111110000000000000000000000011000000000","00000111111111111000000000011000011000011000000000","00000000000000001100000000011000011000011000000000","00000000000000000110000000000000000000011000000000","00000000000000000110000000000000000000011000000000","00000000000000000110000001100000000000011000000000","00000000000000000110000001100000000000011000000000","00000000000000000110000000000000000000011000000000","00000000000000000110000000000000000000011000000000","00000000000000000110000000000000000000011000000000","00000000000000000110000000000000000000110000000000","00000000000000000110000000000000000001100000000000","00000000000000000110000000000000000011000000000000","00000000000000000110000000000000000110000000000000","00000000000000000011111111111111111100000000000000","00000000000000000001111111111111111000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000"]
	var a = map.addon[q.id] = {};
	a.spot = {"q1":{"x":1136,"y":272},"b5":{"x":480,"y":416},"b2":{"x":608,"y":416},"q2":{"x":272,"y":464},"b6":{"x":544,"y":480},"b7":[1024,1216,448,448],"b4":{"x":480,"y":544},"b3":{"x":608,"y":544},"b1":{"x":544,"y":608},"g1":{"x":1104,"y":848},"t1":{"x":784,"y":1008}}
	a.path = {}
	a.variable = {}; 
	a.load = function(spot){
	
		m.teleport(spot.t1,q.event.teleOutUnderground,"zone",{angle:90});
		
		
		
		m.waypoint(spot.g1,true);
		
		m.loot(spot.q1,q.event.dontHaveJewel,q.event.getJewel)
		
		
		
		m.toggle(spot.q2,q.event.viewBlockChest,q.event.tgOnChest);
		
		m.actor(spot.b1,"pushable","rock2x2",{});
		m.actor(spot.b2,"pushable","rock2x2",{});
		m.actor(spot.b3,"pushable","rock2x2",{});
		m.actor(spot.b4,"pushable","rock2x2",{});
		m.actor(spot.b5,"pushable","rock2x2",{});
		m.actor(spot.b6,"pushable","rock2x2",{});
		
		
		m.block(spot.b7,q.event.viewBlockChest,true);
	
	} 
	a.loop = function(spot){
	
	
	
	
	
	
	
	} 
	return map;
};



q.boss['test'] = function(){
	var boss = b.init('v1.0');
	
	boss.opening = 20;
	
	boss.attack['center'] = {
		'type':"bullet",'angle':20,'amount':5, 'aim': 0,
		'objImg':{'name':"fireball",'sizeMod':1},
		'dmg':{'main':50,'ratio':{'melee':1,'range':1,'magic':1,'fire':1,'cold':1,'lightning':1}},	
		'spd':20
	};
	boss.attack['offcenter'] = {
		'type':"bullet",'angle':20,'amount':5, 'aim': 0,
		'objImg':{'name':"fireball",'sizeMod':1},
		'dmg':{'main':100,'ratio':{'melee':1,'range':1,'magic':1,'fire':1,'cold':1,'lightning':1}},	
		'spd':30
	};
	boss.attack['360fire'] =	{
		'type':"bullet",'angle':360,'amount':36, 'aim': 0,
		'objImg':{'name':"fireball",'sizeMod':1},
		'dmg':{'main':50,'ratio':{'melee':1,'range':1,'magic':1,'fire':1,'cold':1,'lightning':1}},	
	};
	boss.attack['slowfire'] = {
		'type':"bullet",'angle':60,'amount':4, 'aim': 0,
		'objImg':{'name':"fireball",'sizeMod':1.5},
		'dmg':{'main':300,'ratio':{'melee':1,'range':1,'magic':1,'fire':1,'cold':1,'lightning':1}},	
		'spd':15,'maxTimer':250,
	};
	boss.attack['weakfire'] = {
		'type':"bullet",'angle':40,'amount':5, 'aim': 0,
		'objImg':{'name':"fireball",'sizeMod':0.75},
		'dmg':{'main':25,'ratio':{'melee':1,'range':1,'magic':1,'fire':1,'cold':1,'lightning':1}},	
	};
	
	boss.phase[0] = {
		loop:function(boss){
			if(!s.interval(25)) return;	//every 25 frame
			
			if(Math.random() < 0.5){
				b.attack(boss,'center',{'angle':boss.angle});			
			} else {
				b.attack(boss,'offcenter',{'angle':boss.angle+boss.opening});
				b.attack(boss,'offcenter',{'angle':boss.angle-boss.opening});			
			}	
			
		},
		transitionTest:function(boss){
			return boss.hpRatio < 0.50;
		}
	}
	boss.phase[1] = {	//big
		loop:function(boss){
			if(boss.frame % 10 !== 0) return;	
			b.attack(boss,'slowfire',{'angle':boss.angle});
		},
		transitionIn:function(boss){
			b.attack(boss,'360fire',{'angle':boss.angle});
			boss.noattack = 25;
			s.setSprite(boss.parent,'',2);
			s.boost(boss.parent,[	
				{'stat':'globalDef','type':"*",'value':10,'time':250,'name':'boss'},
			]); 
		},
		transitionOut:function(boss){
			s.setSprite(boss.parent,'',0.75);
		},
		transitionTest:function(boss){
			return s.interval(250);
		}
	}
	boss.phase[2] = {	//small
		loop:function(boss){
			if(!s.interval(25)) return;
			b.attack(boss,'weakfire',{'angle':boss.angle});
		},
		transitionTest:function(boss){
			return s.interval(100) ? 1 : false;
		}
	}
	
	return boss;
}	

exports.quest = q;





